<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login</title>
    <script>
        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            const response = await fetch(form.action, {
                method: form.method,
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': data._csrf
                },
                body: JSON.stringify({
                    email: data.email,
                    password: data.password
                })
            });

            const result = await response.json();
            const errorDiv = document.getElementById('error');

            if (result.success) {
                window.location.href = '/home';
            } else {
                errorDiv.textContent = result.message;
                errorDiv.style.display = 'block';
            }
        }
    </script>
</head>
<body>
    <h1>Login</h1>
    <form th:action="@{/login}" method="post" onsubmit="handleLogin(event)">
        <div>
            <label for="email">Email:</label>
            <input type="text" id="email" name="email" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div>
            <button type="submit">Login</button>
        </div>
        <div id="error" style="display:none; color:red;"></div>
        <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
    </form>
</body>
</html>